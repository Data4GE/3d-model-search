<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Model Multi-Site Search</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    background: linear-gradient(135deg, #f5f5f5, #e0f0ff);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    position: relative;
    transition: background 0.3s, color 0.3s;
  }

  h2 { text-align:center; margin-bottom:20px; color:#3f7fcc; }
  input[type="text"] { width:100%; margin:10px 0; padding:12px; font-size:16px; border:2px solid #cc4a3f; border-radius:8px; outline:none; transition:border 0.2s; }
  input[type="text"]:focus { border-color:#3f7fcc; }

  #buttonContainer { display:flex; justify-content:center; gap:10px; margin-top:10px; }
  button { padding:10px 20px; font-size:16px; cursor:pointer; border-radius:8px; border:none; color:white; background:linear-gradient(45deg, #cc4a3f, #f5a623); transition: transform 0.2s, box-shadow 0.2s; }
  button:hover { transform:translateY(-2px); box-shadow:0 6px 12px rgba(0,0,0,0.2); }

  #site-options { margin-bottom: 10px; display:flex; flex-wrap:wrap; gap:10px; }
  .site-option { display:flex; align-items:center; gap:5px; }
  .site-option img { width:20px; height:20px; }

  #free-toggle { margin-bottom: 15px; display:flex; align-items:center; }
  #free-toggle input { accent-color:#4caf50; }
  #free-toggle label { margin-left:5px; color:#4caf50; }

  #tags { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; }
  .tag { padding:5px 10px; background:#3f7fcc; color:white; border-radius:5px; cursor:pointer; font-size:14px; }
  .tag:hover { background:#f5a623; }

  #lastSearched { text-align:center; font-style:italic; color:#3f7fcc; margin-bottom:10px; }
  #loading { text-align:center; font-style:italic; color:#888; display:none; }
  #output { display:grid; grid-template-columns:repeat(auto-fit, minmax(220px, 1fr)); gap:15px; margin-top:20px; }

  .card { background:linear-gradient(145deg, #fdf6e3, #e6f0ff); border-radius:12px; padding:15px; display:flex; align-items:center; box-shadow:0 3px 8px rgba(0,0,0,0.15); transition: transform 0.2s, box-shadow 0.2s; position:relative; }
  .card:hover { transform:translateY(-3px); box-shadow:0 6px 15px rgba(0,0,0,0.25); }

  .card img { width:48px; height:48px; margin-right:15px; border-radius:8px; }
  .card a { font-size:18px; color:#cc4a3f; text-decoration:none; }
  .card a:hover { text-decoration:underline; color:#3f7fcc; }

  #previewPopup { position:absolute; border:2px solid #ccc; width:400px; height:300px; display:none; z-index:1000; }
  #previewPopup iframe { width:100%; height:100%; border:none; border-radius:8px; }

  #openAllContainer { text-align:center; margin-top:20px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
  footer { text-align:center; margin-top:40px; font-size:14px; color:#555; flex-shrink:0; }

  body.dark-mode { background: linear-gradient(135deg,#1e1e1e,#2c2c2c); color:#f0f0f0; }
  body.dark-mode h2 { color:#f5a623; }
  body.dark-mode input[type="text"] { background:#333; border:2px solid #f5a623; color:#fff; }
  body.dark-mode button { background: linear-gradient(45deg,#444,#777); }
  body.dark-mode footer { color:#aaa; }
  body.dark-mode .card { background:linear-gradient(145deg,#2b2b2b,#3a3a3a); }
  body.dark-mode .card a { color:#f5a623; }

  #darkModeToggle { position:absolute; top:15px; right:15px; width:40px; height:40px; background:#cc4a3f; color:white; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:18px; cursor:pointer; box-shadow:0 3px 6px rgba(0,0,0,0.2); transition: background 0.3s, transform 0.2s; }
  #darkModeToggle:hover { background:#3f7fcc; transform:scale(1.1); }
</style>
</head>
<body>
<div id="darkModeToggle" onclick="toggleDarkMode()">üåô</div>

<h2>3D Model Multi-Site Search</h2>

<label for="searchTerm">Search for:</label>
<input type="text" id="searchTerm" placeholder="Type your query..." />

<div id="tags"></div>

<div style="display:flex; gap:10px; align-items:center; margin:10px 0;">
  <select id="searchHistory" style="flex:1;">
    <option value="">-- Recent Searches --</option>
  </select>
  <button onclick="clearHistory()">Clear History</button>
</div>

<div id="buttonContainer">
  <button onclick="generateLinks()">Search</button>
  <button onclick="clearSearch()">Clear</button>
</div>

<div id="site-options"></div>

<div id="free-toggle">
  <input type="checkbox" id="freeOnlyCheckbox" checked>
  <label for="freeOnlyCheckbox">Free Models Only</label>
</div>

<div id="lastSearched"></div>
<div id="loading">Generating links...</div>
<div id="output"></div>

<div id="openAllContainer">
  <button onclick="openAll()">Open All</button>
  <button onclick="exportLinks()">Export Links</button>
  <button onclick="copyShareURL()">Copy Shareable URL</button>
</div>

<div id="previewPopup"><iframe></iframe></div>

<footer>
  Made by Arcade Anvil - DataForge 2025
</footer>

<script>
const sites = [
  { name: "Thingiverse", urlFree:"https://www.thingiverse.com/search?q={q_plus}&page=1&sort=relevant", urlAll:"https://www.thingiverse.com/search?q={q_plus}&page=1&sort=relevant", logo:"https://www.thingiverse.com/favicon.ico" },
  { name: "Thangs", urlFree:"https://thangs.com/search/{q}?searchScope=thangs&scope=all&freeModels=true", urlAll:"https://thangs.com/search/{q}?searchScope=thangs&scope=all", logo:"https://thangs.com/favicon.ico" },
  { name: "Printables", urlFree:"https://www.printables.com/search/models?q={q_plus}", urlAll:"https://www.printables.com/search/models?q={q_plus}", logo:"https://www.printables.com/favicon.ico" },
  { name: "Cults3D", urlFree:"https://cults3d.com/en/search?only_free=true&q={q_plus}", urlAll:"https://cults3d.com/en/search?q={q_plus}", logo:"https://cults3d.com/favicon.ico" },
  { name: "MyMiniFactory", logo:"https://www.myminifactory.com/favicon.ico" },
  { name: "MakerWorld", urlFree:"https://makerworld.com/en/search/models?keyword={q_plus}", urlAll:"https://makerworld.com/en/search/models?keyword={q_plus}", logo:"https://makerworld.com/favicon.ico" }
];

let currentLinks=[], searchHistory=JSON.parse(localStorage.getItem("searchHistory"))||[], tags=["cosplay","miniatures","gadgets","tools","figurines"];

const siteOptionsDiv=document.getElementById("site-options");
sites.forEach((site,index)=>{
  const label=document.createElement("label");
  label.className="site-option";
  label.innerHTML=`<input type="checkbox" checked data-index="${index}"><img src="${site.logo}" alt="${site.name}"> ${site.name}`;
  siteOptionsDiv.appendChild(label);
});

const tagsDiv=document.getElementById("tags");
tags.forEach(t=>{
  const tag=document.createElement("div");
  tag.className="tag";
  tag.textContent=t;
  tag.onclick=()=>{document.getElementById("searchTerm").value=t; generateLinks();};
  tagsDiv.appendChild(tag);
});

function generateMyMiniFactoryLink(searchTerm, freeOnly){
  const baseURL=freeOnly
    ? 'https://www.myminifactory.com/search#/?{%22searchString%22:%22__QUERY__%22,%22categories%22:[],%22designType%22:%22free-only%22,%22sortingKey%22:%22%22,%22tags%22:[]}'
    : 'https://www.myminifactory.com/search#/?{%22searchString%22:%22__QUERY__%22,%22categories%22:[],%22designType%22:%22all%22,%22sortingKey%22:%22%22,%22tags%22:[]}';
  return baseURL.replace("__QUERY__", encodeURIComponent(searchTerm));
}

function generateLinks(){
  const rawTerm=document.getElementById("searchTerm").value.trim();
  if(!rawTerm) return;
  document.getElementById("loading").style.display="block";
  setTimeout(()=>{
    const term=encodeURIComponent(rawTerm);
    const termPlus=rawTerm.replace(/\s+/g,"+");
    const freeOnly=document.getElementById("freeOnlyCheckbox").checked;
    document.getElementById("lastSearched").textContent=`Last searched: "${rawTerm}"`;

    if(!searchHistory.includes(rawTerm)){searchHistory.unshift(rawTerm); if(searchHistory.length>10)searchHistory.pop(); localStorage.setItem("searchHistory",JSON.stringify(searchHistory)); updateHistoryDropdown();}

    const checkboxes=document.querySelectorAll("#site-options input[type='checkbox']");
    const selectedSites=[], popup=document.getElementById("previewPopup");
    currentLinks=[];
    checkboxes.forEach(cb=>{
      if(cb.checked){
        const site=sites[cb.dataset.index]; selectedSites.push(site);
        let link;
        if(site.name==="MyMiniFactory"){link=generateMyMiniFactoryLink(rawTerm,freeOnly);}
        else if(freeOnly && site.urlFree){link=site.urlFree.replace("{q}",term).replace("{q_plus}",termPlus);}
        else{link=site.urlAll.replace("{q}",term).replace("{q_plus}",termPlus);}
        currentLinks.push(link);
      }
    });

    const output=document.getElementById("output");
    output.innerHTML="";
    selectedSites.forEach((site,index)=>{
      const card=document.createElement("div");
      card.className="card";
      card.innerHTML=`<img src="${site.logo}" alt="${site.name}"><a href="${currentLinks[index]}" target="_blank">${site.name}</a>`;
      card.onmouseenter=e=>{popup.style.display="block"; popup.style.top=(e.clientY+10)+"px"; popup.style.left=(e.clientX+10)+"px"; popup.querySelector("iframe").src=currentLinks[index];};
      card.onmouseleave=()=>{popup.style.display="none"; popup.querySelector("iframe").src="";};
      output.appendChild(card);
    });
    document.getElementById("loading").style.display="none";
  },300);
}

function openAll(){if(currentLinks.length===0)return; currentLinks.forEach(link=>window.open(link,"_blank"));}
function exportLinks(){if(currentLinks.length===0)return; const blob=new Blob([currentLinks.join("\n")],{type:"text/plain"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download="search_links.txt"; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);}
function copyShareURL(){const term=document.getElementById("searchTerm").value.trim(); if(!term) return; const checkboxes=document.querySelectorAll("#site-options input[type='checkbox']"); const selectedSites=[]; checkboxes.forEach(cb=>{if(cb.checked) selectedSites.push(sites[cb.dataset.index].name.toLowerCase());}); const freeOnly=document.getElementById("freeOnlyCheckbox").checked; const url=window.location.origin+window.location.pathname+`?q=${encodeURIComponent(term)}&sites=${selectedSites.join(",")}&free=${freeOnly}`; navigator.clipboard.writeText(url).then(()=>alert("Shareable URL copied!"));}

function clearSearch(){document.getElementById("searchTerm").value=""; document.getElementById("lastSearched").textContent=""; document.getElementById("output").innerHTML=""; currentLinks=[];}
function toggleDarkMode(){document.body.classList.toggle("dark-mode"); document.getElementById("darkModeToggle").textContent=document.body.classList.contains("dark-mode")?"‚òÄÔ∏è":"üåô";}

function updateHistoryDropdown(){const dropdown=document.getElementById("searchHistory"); dropdown.innerHTML='<option value="">-- Recent Searches --</option>'; searchHistory.forEach(term=>{const option=document.createElement("option"); option.value=term; option.textContent=term; dropdown.appendChild(option);});}
function clearHistory(){searchHistory=[]; localStorage.removeItem("searchHistory"); updateHistoryDropdown();}

document.getElementById("searchHistory").addEventListener("change",function(){if(this.value){document.getElementById("searchTerm").value=this.value; generateLinks();}});
document.getElementById("searchTerm").addEventListener("keypress",function(e){if(e.key==="Enter"&&!e.shiftKey){e.preventDefault(); generateLinks();} else if(e.key==="Enter"&&e.shiftKey){e.preventDefault(); openAll();}});
document.addEventListener("keydown",function(e){if(e.ctrlKey&&e.key.toLowerCase()==="e"){e.preventDefault(); exportLinks();}});

updateHistoryDropdown();

// Auto-load from URL if shareable link
const params=new URLSearchParams(window.location.search);
const q=params.get("q"); const sitesParam=params.get("sites"); const free=params.get("free")==="true";
if(q){document.getElementById("searchTerm").value=q; document.getElementById("freeOnlyCheckbox").checked=free; if(sitesParam){const arr=sitesParam.split(","); document.querySelectorAll("#site-options input[type='checkbox']").forEach(cb=>{cb.checked=arr.includes(sites[cb.dataset.index].name.toLowerCase())});} generateLinks();}
</script>
</body>
</html>
